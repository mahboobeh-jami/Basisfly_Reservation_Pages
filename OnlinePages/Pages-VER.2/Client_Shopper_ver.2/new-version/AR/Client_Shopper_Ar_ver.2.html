<basis core="api" name="api.schema" run="AtClient" url="https://basisfly.com/panel/main/view/[##cms.cookie.rkey##]"
    method="post" body='{
        "member": [
                {
                        "type": "list",
                        "name": "buyer_info",
                        "request": "buyer_info",
                        "lid": "3",
                        "rkey": "[##cms.cookie.rkey##]"
                }
        ]
}' onprocessed="onProcessedBuyerSchema"></basis>
<basis core="api" name="api.useridentityinfo" run="AtClient"
    url="https://api.trust-login.com/[##cms.cookie.rkey##]/useridentityinfo" method="get"
    onprocessed="onProcessedBuyerIdentityInfo">
</basis>


<basis core="api" name="api.edituser" if="{##db.editUser.run|(false)##}" run="AtClient"
    url="https://api.trust-login.com/schema/{##db.editUser.rkey##}/editobject" method="post"
    body='{##db.editUser.objEditUser##}' triggers="db.editUser">
</basis>

<div class="buyer-ckeck-user">
    <input type="hidden" value="" name="mid" class="mid" />
    <input type="hidden" value="" name="accounttype" class="accounttype" />
    <div class="buyer-info-content box-content unvisible buyer-ckeck-user-1">
        <div class="buyer-type">
            <ul>
                <li class="buyer-type-passenger active" onclick="passenger_type(this,'passenger')">الحجز للمسافرين
                </li>
                <li class="buyer-type-agency" onclick="passenger_type(this,'agency')">الحجز للوكالة</li>
            </ul>
        </div>
        <div class="passenger-content">
            <div class="package-info-item">
                <label>الإسم</label>
                <div class="inner-item"><input type="text" data-name="_root.account.fullname.firstname"
                        class="necessary name firstname" />
                </div>
            </div>
            <div class="package-info-item">
                <label>اللقب</label>
                <div class="inner-item"><input type="text" data-name="_root.account.fullname.lastname"
                        class="necessary name lastname" /></div>
            </div>
            <div class="package-info-item">
                <label>البرید الإلکتروني</label>
                <div class="inner-item"><input type="text" data-name="_root.account.email" class="necessary email" />
                </div>
            </div>
            <div class="package-info-item">
                <label> هاتف</label>
                <div class="package-number-items">
                    <div class="package-number-item">
                        <div class="inner-item"><input type="text" class="has-dash tel"
                                onkeyup="this.value=this.value.replace(/[^0-9.]/g, '');" />
                        </div>
                    </div>
                    <div class="package-code-item has-select">
                        <div class="inner-item"><input type="text" value="+98" onclick="toggle_code(this)"
                                class="has-dash code" oninput="autoComplete_search_buyer(event,this,'code')"
                                onkeyup="tab_key_buyer(event,this);" /></div>
                        <ul class="drop-item country-code">

                        </ul>
                    </div>
                    <input type="hidden" class="code-number" data-name="_root.account.telCode" value="+98" />
                    <input type="hidden" class="tel-info" data-name="_root.account.tel" />
                    <div class="clr"></div>
                </div>
            </div>
            <div class="package-info-item">
                <label> الهاتف الخلوي</label>
                <div class="package-number-items">
                    <div class="package-number-item">
                        <div class="inner-item"><input type="text" class="necessary mobile"
                                onkeyup="this.value=this.value.replace(/[^0-9.]/g, '');" />
                        </div>
                    </div>
                    <div class="package-code-item has-select">
                        <div class="inner-item"><input type="text" value="+98" onclick="toggle_code(this)"
                                class="necessary code" oninput="autoComplete_search_buyer(event,this,'code')"
                                onkeyup="tab_key_buyer(event,this);" /></div>
                        <ul class="drop-item country-code">

                        </ul>
                    </div>
                    <input type="hidden" class="code-number" data-name="_root.account.mobileCode" value="+98" />
                    <input type="hidden" class="mobile-info" data-name="_root.account.mobile" />
                    <div class="clr"></div>
                </div>
            </div>
            <div class="package-info-item">
                <label> العنوان</label>
                <div class="inner-item"><input type="text" class="has-dash address" data-name="_root.account.address" />
                </div>
            </div>
            <div class="package-info-item has-select-input">
                <label> الجنس</label>
                <div class="inner-item">
                    <input type="text" class="gender" value="ذكر" onclick="toggle_gender(this)"
                        onkeyup="tab_key(event,this)" readonly="true" />
                    <input class="gender-id" value="1" type="hidden" data-name="_root.account.gender" />
                </div>
                <ul class="drop-item wide">
                    <li onclick="select_gender_val(this)" class="li-item" data-value="0">أنثى</li>
                    <li onclick="select_gender_val(this)" class="li-item" data-value="1">ذكر</li>
                </ul>
            </div>
        </div>
        <div class="agency-content unvisible">
            <div class="package-info-item has-select-input">
                <i class="fa fa-spinner unvisible"></i>
                <label>قم باختيار الوكالة المطلوبة</label>
                <div class="inner-item"><input type="text" name="" class="name selected-agency"
                        onclick="toggle_agency_list(this)" oninput="autoComplete_search_buyer(event,this,'agency')"
                        data-load="0" />
                    <ul class="drop-item wide"></ul>
                </div>
            </div>
            <div class="clr"></div>
            <div class="agency-information-container unvisible">
                <div id="ballsWaveG">
                    <div id="ballsWaveG_1" class="ballsWaveG"></div>
                    <div id="ballsWaveG_2" class="ballsWaveG"></div>
                    <div id="ballsWaveG_3" class="ballsWaveG"></div>
                    <div id="ballsWaveG_4" class="ballsWaveG"></div>
                    <div id="ballsWaveG_5" class="ballsWaveG"></div>
                    <div id="ballsWaveG_6" class="ballsWaveG"></div>
                    <div id="ballsWaveG_7" class="ballsWaveG"></div>
                    <div id="ballsWaveG_8" class="ballsWaveG"></div>
                </div>
            </div>
            <div class="clr"></div>
        </div>
        <div class="clr"></div>
    </div>
    <div class="buyer-info-content box-content unvisible buyer-ckeck-user-2">
        <input type="hidden" data-name="_root.account.agencyid" class="agencyid" value="" />
        <div class="package-info-item">
            <label> الإسم </label>
            <div class="inner-item"><input type="text" value="" class="name Agencyname"
                    data-name="_root.account.Agencyname" readonly /></div>
        </div>
        <div class="package-info-item">
            <label> اللقب</label>

            <div class="inner-item"><input type="text" value="" class="name Agencymanegername"
                    data-name="_root.account.Agencymanegername" readonly /></div>
        </div>
        <div class="package-info-item">
            <label> البرید الإلکتروني</label>
            <div class="inner-item"><input type="text" value="" class="email" data-name="_root.account.Agencyemail"
                    readonly /></div>
        </div>
        <div class="package-info-item">
            <label> هاتف</label>
            <div class="package-number-items">
                <div class="package-number-item">
                    <div class="inner-item"><input type="text" value="" class="has-dash tel" readonly /></div>
                </div>
                <div class="package-code-item has-select">
                    <div class="inner-item"><input type="text" value="+98" class="has-dash code" readonly />
                    </div>
                    <ul class="drop-item country-code">

                    </ul>
                </div>
                <input type="hidden" class="code-number" data-name="_root.account.AgencytellCode" value="+98" />
                <input type="hidden" class="tel-info" data-name="_root.account.Agencytell" />
                <div class="clr"></div>
            </div>
        </div>
        <div class="package-info-item">
            <label> الهاتف الخلوي</label>
            <div class="package-number-items">
                <div class="package-number-item">
                    <div class="inner-item"><input type="text" value="" class="necessary mobile"
                            onkeyup="this.value=this.value.replace(/[^0-9.]/g, '');" /></div>
                </div>
                <div class="package-code-item has-select">
                    <div class="inner-item"><input type="text" value="+98" onclick="toggle_code(this)"
                            class="necessary code" oninput="autoComplete_search_buyer(event,this,'code')"
                            onkeyup="tab_key_buyer(event,this);" /></div>
                    <ul class="drop-item country-code">

                    </ul>
                </div>
                <input type="hidden" class="code-number" name="_root.account.AgencymobileCode" value="+98" />
                <input type="hidden" class="mobile-info" name="_root.account.Agencymobile" />
                <div class="clr"></div>
            </div>
        </div>
        <div class="package-info-item">
            <label> العنوان</label>
            <div class="inner-item"><input type="text" value="" class="has-dash address"
                    data-name="_root.account.Agencyaddress" readonly /></div>
        </div>
        <div class="package-info-item">
            <label> موقع إلكتروني</label>
            <div class="inner-item"><input type="text" value="" class="web" data-name="_root.account.Agencyweb"
                    readonly />
            </div>
        </div>
        <div class="clr"></div>
    </div>
    <div class="buyer-info-content box-content check-has-data">
        <div class="package-info-item">
            <label>الإسم</label>
            <div class="inner-item"><input type="text" data-changed="0" oninput="check_isChanged(this)" value=""
                    data-counter="namecounter" data-name="_root.account.fullname.firstname"
                    class="necessary name firstname" data-prpId="1" />
            </div>
        </div>
        <div class="package-info-item">
            <label>اللقب</label>
            <div class="inner-item"><input type="text" data-changed="0" oninput="check_isChanged(this)" value=""
                    data-counter="familycounter" data-name="_root.account.fullname.lastname"
                    class="necessary name lastname" data-prpId="2" /></div>
        </div>
        <div class="package-info-item">
            <label>البرید الإلکتروني</label>
            <div class="inner-item"><input type="text" value="" data-name="_root.account.email"
                    data-counter="emailcounter" class="necessary email" />
            </div>
        </div>
        <div class="package-info-item">
            <label> هاتف</label>
            <div class="package-number-items">
                <div class="package-number-item">
                    <div class="inner-item"><input type="text" data-changed="0" oninput="check_isChanged(this)" value=""
                            class="has-dash tel" onkeyup="this.value=this.value.replace(/[^0-9.]/g, '');"
                            data-prpId="4" />
                    </div>
                </div>
                <div class="package-code-item has-select">
                    <div class="inner-item"><input type="text" value="+98" onclick="toggle_code(this)"
                            class="has-dash code" oninput="autoComplete_search_buyer(event,this,'code')"
                            onkeyup="tab_key_buyer(event,this);" /></div>
                    <ul class="drop-item country-code">

                    </ul>
                </div>
                <input type="hidden" class="code-number" data-name="_root.account.telCode" value="+98" />
                <input type="hidden" class="tel-info" data-name="_root.account.tel" />
                <div class="clr"></div>
            </div>
        </div>
        <div class="package-info-item">
            <label> الهاتف الخلوي</label>
            <div class="package-number-items">
                <div class="package-number-item">
                    <div class="inner-item"><input type="text" value="" class="necessary mobile"
                            onkeyup="this.value=this.value.replace(/[^0-9.]/g, '');" /></div>
                </div>
                <div class="package-code-item has-select">
                    <div class="inner-item"><input type="text" value="+98" onclick="toggle_code(this)"
                            class="necessary code" oninput="autoComplete_search_buyer(event,this,'code')"
                            onkeyup="tab_key_buyer(event,this);" /></div>
                    <ul class="drop-item country-code">

                    </ul>
                </div>
                <input type="hidden" class="code-number" data-name="_root.account.mobileCode" value="+98" />
                <input type="hidden" class="mobile-info" data-name="_root.account.mobile" />
                <div class="clr"></div>
            </div>
        </div>
        <div class="package-info-item">
            <label> العنوان</label>
            <div class="inner-item"><input type="text" data-changed="0" oninput="check_isChanged(this)" value=""
                    class="has-dash address" data-name="_root.account.address" data-prpId="6" />
            </div>
        </div>
        <div class="package-info-item has-select-input">
            <label> الجنس</label>
            <div class="inner-item">
                <input type="text" class="gender" value="ذكر" onclick="toggle_gender(this)"
                    onkeyup="tab_key(event,this)" readonly="true" />
                <input class="gender-id" value="1" type="hidden" data-name="_root.account.gender" />
                <input class="gender-id-trust" value="668" type="hidden" data-prpId="7" data-changed="0" />
            </div>
            <ul class="drop-item wide">
                <li onclick="select_gender_val(this)" class="li-item" data-value="0" data-trust="666">أنثى</li>
                <li onclick="select_gender_val(this)" class="li-item" data-value="1" data-trust="668">ذكر</li>
            </ul>
        </div>
        <div class="clr"></div>
        <div class="more-buyer-info-container">
            <button type="button" class="cursor-pointer" onclick="toggle_more_buyer_info(this)">مزيد من
                المعلومات</button>
            <div class="more-buyer-info-content unvisible">

                <div class="package-info-item">
                    <label> تاریخ الولادة</label>
                    <div class="inner-item"><input type="text" readonly value="" class="has-dash birthdate"
                            data-name="_root.account.birthdate" data-prpId="8" />
                    </div>
                </div>


                <div class="package-info-item">
                    <label> رقم البرید</label>
                    <div class="inner-item"><input type="text" value="" class="has-dash codepost"
                            data-name="_root.account.codepost" />
                    </div>
                </div>

                <div class="package-info-item">
                    <label> دولة</label>
                    <div class="inner-item"><input type="text" value="ایران" readonly /><input type="hidden"
                            value="1002236" name="_root.account.countryid" /></div>
                </div>
                <div class="package-info-item">
                    <label> مدينة</label>
                    <div class="inner-item"><input type="text" value="تهران" readonly /><input type="hidden"
                            value="1203548" name="_root.account.cityid" /></div>
                </div>
                <div class="clr"></div>
            </div>
        </div>
        <div class="clr"></div>
    </div>
</div>

<script src="https://cdn.basiscore.net/basisfly.com/js/reservation_shopper_js_view_Ar.js" type="text/javascript">
</script>
<script type="text/javascript">
    function check_isChanged(element) { element.dataset.changed = 1; }
    async function onProcessedBuyerIdentityInfo(args) {
        const response = args.response;
        const responseJson = await response.json();
        if (!responseJson.errorMessage) {
            if (responseJson.errorid == 1) {
                console.log('useridentityinfo' + responseJson.message)
            } else {
                document.querySelectorAll(".check-has-data").forEach(ie => {
                    ie.querySelector(".email").value = responseJson.emailInfo.email;
                })
                document.querySelectorAll(".check-has-data").forEach(ie => {
                    ie.querySelector(".mobile").value = responseJson.mobileInfo.mobile;
                })
            }

        }

    }
    async function onProcessedBuyerSchema(args) {
        document.querySelector(".buyers-info-content").querySelector("#ballsWaveG").remove();
        document.querySelector(".buyers-info-content").setAttribute("data-load", 1);
        const response = args.response;
        const responseJson = await response.json();
        if (!responseJson.errorMessage) {
            const accounttype = responseJson.sources[0].data[0].accounttype;
            const properties = responseJson.sources[0].data[0].user_info.sources[0].data[0].properties;
            document.querySelector(".buyers-info-content").querySelector(".buyer-ckeck-user").classList.add(`buyer-${accounttype}`);
            document.querySelector(".buyers-info-content").querySelector(".accounttype").value = accounttype;
            switch (accounttype) {
                case 1:
                    mid = 24;
                    break;
                case 2:
                    mid = 24;
                    break;
                case 3:
                    mid = 24;
                    break;
            }
            document.querySelector(".buyers-info-content").querySelector(".mid").value = mid;
            if (accounttype == 3) {
                document.querySelector(".buyers-info-content").querySelector(".buyer-ckeck-user-1").remove();
                document.querySelector(".buyers-info-content").querySelector(".buyer-ckeck-user-2").remove();
                document.querySelector(".buyers-info-content").querySelector(".check-has-data").querySelectorAll("input").forEach(e => {
                    if (e.getAttribute("data-name")) {
                        e.setAttribute("name", e.getAttribute("data-name"))
                    }
                });
            } else {
                document.querySelector(".buyers-info-content").querySelector(".check-has-data").classList.add("counter-info-content");
                document.querySelector(".buyers-info-content").querySelector(".check-has-data").insertAdjacentHTML('afterbegin', `<p class="buyer-info-content-title">اطلاعات کانتر</p>`);
                document.querySelector(".buyers-info-content").querySelector(".check-has-data").querySelectorAll("input").forEach(e => {
                    if (e.getAttribute("data-counter")) {
                        e.setAttribute("data-name", `_root.account.${e.getAttribute("data-counter")}`);
                        e.setAttribute("name", e.getAttribute("data-name"));
                    }
                });
                if (accounttype == 2) {
                    document.querySelector(".buyers-info-content").querySelector(".buyer-ckeck-user-1").remove();
                    document.querySelector(".buyers-info-content").querySelector(".buyer-ckeck-user-2").classList.remove("unvisible");
                    document.querySelector(".buyers-info-content").querySelector(".buyer-ckeck-user-2").querySelectorAll("input").forEach(e => {
                        if (e.getAttribute("data-name")) {
                            e.setAttribute("name", e.getAttribute("data-name"))
                        }
                    });
                    const buyerInformation = responseJson.sources[0].data[0].buyer_information;
                    document.querySelector(".buyers-info-content").querySelector(".buyer-ckeck-user-2").querySelector(".agencyid").value = buyerInformation.id;
                    document.querySelector(".buyers-info-content").querySelector(".buyer-ckeck-user-2").querySelector(".Agencyname").value = buyerInformation.name;
                    document.querySelector(".buyers-info-content").querySelector(".buyer-ckeck-user-2").querySelector(".Agencymanegername").value = buyerInformation.manager;
                    document.querySelector(".buyers-info-content").querySelector(".buyer-ckeck-user-2").querySelector(".email").value = buyerInformation.email;
                    document.querySelector(".buyers-info-content").querySelector(".buyer-ckeck-user-2").querySelector(".tel").value = buyerInformation.phones[0].phone;
                    document.querySelector(".buyers-info-content").querySelector(".buyer-ckeck-user-2").querySelector(".mobile").value = buyerInformation.mobile;
                    document.querySelector(".buyers-info-content").querySelector(".buyer-ckeck-user-2").querySelector(".address").value = buyerInformation.address;
                    document.querySelector(".buyers-info-content").querySelector(".buyer-ckeck-user-2").querySelector(".web").value = buyerInformation.website;
                } else {
                    document.querySelector(".buyers-info-content").querySelector(".buyer-ckeck-user-2").remove();
                    document.querySelector(".buyers-info-content").querySelector(".buyer-ckeck-user-1").classList.remove("unvisible");
                    document.querySelector(".buyers-info-content").querySelector(".buyer-ckeck-user-1").querySelectorAll("input").forEach(e => {
                        if (e.getAttribute("data-name")) {
                            e.setAttribute("name", e.getAttribute("data-name"))
                        }
                    });
                }
            }

            document.querySelector(".check-has-data").setAttribute("data-hashId", responseJson.sources[0].data[0].user_info.sources[0].data[0].schemaId);
            properties?.forEach((e) => {
                if (e.prpId == 1) {
                    document.querySelector(".check-has-data").querySelector(".firstname").value = e.answers[0].parts[0].values[0].value;
                    document.querySelector(".check-has-data").querySelector(".firstname").setAttribute("data-id", e.answers[0].id ? e.answers[0].id : '');
                    document.querySelector(".check-has-data").querySelector(".firstname").setAttribute("data-valueId", e.answers[0].parts[0].values[0].id ? e.answers[0].parts[0].values[0].id : e.answers[0].parts[0].values[0].id);
                } else if (e.prpId == 2) {
                    document.querySelector(".check-has-data").querySelector(".lastname").value = e.answers[0].parts[0].values[0].value;
                    document.querySelector(".check-has-data").querySelector(".lastname").setAttribute("data-id", e.answers[0].id ? e.answers[0].id : '');
                    document.querySelector(".check-has-data").querySelector(".lastname").setAttribute("data-valueId", e.answers[0].parts[0].values[0].id ? e.answers[0].parts[0].values[0].id : e.answers[0].parts[0].values[0].id ? e.answers[0].parts[0].values[0].id : e.answers[0].parts[0].values[0].id);
                } else if (e.prpId == 4) {
                    document.querySelector(".check-has-data").querySelector(".tel").value = e.answers[0].parts[0].values[0].value;
                    document.querySelector(".check-has-data").querySelector(".tel").setAttribute("data-id", e.answers[0].id ? e.answers[0].id : '');
                    document.querySelector(".check-has-data").querySelector(".tel").setAttribute("data-valueId", e.answers[0].parts[0].values[0].id ? e.answers[0].parts[0].values[0].id : e.answers[0].parts[0].values[0].id);

                } else if (e.prpId == 6) {
                    document.querySelector(".check-has-data").querySelector(".address").value = e.answers[0].parts[0].values[0].value;
                    document.querySelector(".check-has-data").querySelector(".address").setAttribute("data-id", e.answers[0].id ? e.answers[0].id : '');
                    document.querySelector(".check-has-data").querySelector(".address").setAttribute("data-valueId", e.answers[0].parts[0].values[0].id ? e.answers[0].parts[0].values[0].id : e.answers[0].parts[0].values[0].id);
                }
                else if (e.prpId == 7) {

                    if (e.answers[0].parts[0].values[0].value == 666) {
                        document.querySelector(".check-has-data").querySelector(".gender-id-trust").value = 666;
                        document.querySelector(".check-has-data").querySelector(".gender-id").value = 0;
                        document.querySelector(".check-has-data").querySelector(".gender").value = "أنثى";
                    } else {
                        document.querySelector(".check-has-data").querySelector(".gender-id-trust").value = 668;
                        document.querySelector(".check-has-data").querySelector(".gender-id").value = 1;
                        document.querySelector(".check-has-data").querySelector(".gender").value = "ذكر";
                    }
                    document.querySelector(".check-has-data").querySelector(".gender-id-trust").setAttribute("data-id", e.answers[0].id ? e.answers[0].id : '');
                    document.querySelector(".check-has-data").querySelector(".gender-id-trust").setAttribute("data-valueId", e.answers[0].parts[0].values[0].id ? e.answers[0].parts[0].values[0].id : e.answers[0].parts[0].values[0].id);


                }
                else if (e.prpId == 8) {

                    document.querySelector(".check-has-data").querySelector(".birthdate").value = e.answers[0].parts[0].values[0].value;
                    document.querySelector(".check-has-data").querySelector(".birthdate").setAttribute("data-id", e.answers[0].id ? e.answers[0].id : '');
                    document.querySelector(".check-has-data").querySelector(".birthdate").setAttribute("data-valueId", e.answers[0].parts[0].values[0].id ? e.answers[0].parts[0].values[0].id : e.answers[0].parts[0].values[0].id);
                }
                else if (e.prpId == 9) {
                    document.querySelector(".check-has-data").querySelector(".codepost").value = e.answers[0].parts[0].values[0].value;
                    document.querySelector(".check-has-data").querySelector(".codepost").setAttribute("data-id", e.answers[0].id ? e.answers[0].id : '');
                    document.querySelector(".check-has-data").querySelector(".codepost").setAttribute("data-valueId", e.answers[0].parts[0].values[0].id ? e.answers[0].parts[0].values[0].id : e.answers[0].parts[0].values[0].id);

                }
            });
            if (accounttype !== 3) {
                document.querySelector(".buyers-info-content").querySelector(".check-has-data").querySelectorAll("input").forEach(e => {
                    if (e.value.length > 1) {
                        if (e.getAttribute("data-changed")) {
                            e.readOnly = true;
                        }
                    }
                });
            }


        }

    }
</script>